Ext.ux.FlashPlugin=function(){this.init=function(a){a.flashTemplate=new Ext.XTemplate("<div>",'<object id="flash-{id}" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" width="{swfWidth}" height="{swfHeight}">','<param name="movie" value="{swf}" />','<param name="quality" value="high" />','<param name="wmode" value="transparent" />','<param name="flashvars" value="{computedflashvars}" />','<param name="allowScriptAccess" value="domain" />','<param name="align" value="t" />','<param name="salign" value="TL" />','<param name="swliveconnect" value="true" />','<param name="scale" value="showall" />','<embed name="flash-{id}" src="{swf}" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="{computedflashvars}" type="application/x-shockwave-flash" width="{swfWidth}" height="{swfHeight}" wmode="transparent" allowScriptAccess="always" swliveconnect="true" align="t" salign="TL" scale="showall"></embed>',"</object>","</div>");a.flashTemplate.compile();a.renderFlash=function(){if(this.flashvars&&(typeof this.flashvars=="object")){var b=Ext.apply({},this.flashvars);for(var c in b){if(typeof b[c]=="function"){b[c]=b[c].call(this,true)}}if(!Ext.isEmpty(b.data)&&!Ext.isEmpty(token)){b.data+="&token="+token}this.computedflashvars=Ext.urlEncode(b)}this.swfHeight=this.body.getSize().height-2;this.swfWidth=this.body.getSize().width-2;if(this.body.first()){this.flashTemplate.overwrite(this.body.first(),this)}else{this.flashTemplate.insertFirst(this.body,this)}};a.loadFlash=function(b){Ext.apply(this,b);this.renderFlash()};a.on("afterlayout",a.renderFlash,a)}};Ext.namespace("Ext.ux","Ext.ux.menu");Ext.ux.ColorPicker=Ext.extend(Ext.BoxComponent,{showWebSafeColorbox:false,showInverseColorbox:false,showColorbox:true,initComponent:function(){this.applyDefaultsCP();Ext.ux.ColorPicker.superclass.initComponent.apply(this,arguments);this.addEvents("select")},onRender:function(){Ext.ux.ColorPicker.superclass.onRender.apply(this,arguments);this.body=this.body||(this.container||(this.renderTo||Ext.DomHelper.append(Ext.getBody(),{},true)));if(!this.el){this.el=this.body;if(this.cls){Ext.get(this.el).addClass(this.cls)}}this.renderComponent()},applyDefaultsCP:function(){Ext.apply(this,{cls:"x-cp-mainpanel",resizable:this.resizable||false,HSV:{h:0,s:0,v:0},updateMode:null})},renderComponent:function(){Ext.DomHelper.append(this.body,{id:this.cpGetId("rgb"),cls:"x-cp-rgbpicker"});Ext.DomHelper.append(this.body,{id:this.cpGetId("hue"),cls:"x-cp-huepicker"});this.huePicker=Ext.DomHelper.append(this.body,{cls:"x-cp-hueslider"});this.hueDD=new Ext.dd.DD(this.huePicker,"huePicker");this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:-3,bottom:-7,left:-3});this.hueDD.onDrag=this.moveHuePicker.createDelegate(this);Ext.get(this.cpGetId("hue")).on("mousedown",this.clickHUEPicker.createDelegate(this));Ext.get(this.huePicker).moveTo(Ext.get(this.cpGetId("hue")).getLeft()-3,Ext.get(this.cpGetId("hue")).getTop()-7);this.rgbPicker=Ext.DomHelper.append(this.body,{cls:"x-cp-rgbslider"});this.rgbDD=new Ext.dd.DD(this.rgbPicker,"rgbPicker");this.rgbDD.constrainTo(this.cpGetId("rgb"),-7);this.rgbDD.onDrag=this.moveRGBPicker.createDelegate(this);Ext.get(this.cpGetId("rgb")).on("mousedown",this.clickRGBPicker.createDelegate(this));Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()-7,Ext.get(this.cpGetId("rgb")).getTop()-7);this.formPanel=new Ext.form.FormPanel({border:false,renderTo:Ext.DomHelper.append(this.body,{id:this.cpGetId("fCont"),cls:"x-cp-formcontainer"},true),frame:false,labelAlign:"left",labelWidth:10,items:[{border:false,layout:"form",id:this.cpGetId("cCont")},{bodyStyle:"padding-top:10px;",border:false,layout:"column",items:[{border:false,columnWidth:0.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:false,labelSeparator:"",enableKeyEvents:true},items:[{fieldLabel:"R",id:this.cpGetId("iRed")},{fieldLabel:"G",id:this.cpGetId("iGreen")},{fieldLabel:"B",id:this.cpGetId("iBlue")}]},{border:false,columnWidth:0.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:false,labelSeparator:"",enableKeyEvents:true},items:[{fieldLabel:"H",maxValue:360,id:this.cpGetId("iHue")},{fieldLabel:"S",id:this.cpGetId("iSat")},{fieldLabel:"V",id:this.cpGetId("iVal")}]},{border:false,layout:"form",labelAlign:"left",items:[{width:88,value:"000000",labelSeparator:"",allowBlank:false,fieldLabel:"#",id:this.cpGetId("iHexa"),value:"000000",xtype:"hexfield",enableKeyEvents:true}]}]}]});Ext.getCmp(this.cpGetId("iRed")).on("keyup",this.updateFromIRGB.createDelegate(this),{buffer:750});Ext.getCmp(this.cpGetId("iGreen")).on("keyup",this.updateFromIRGB.createDelegate(this),{buffer:750});Ext.getCmp(this.cpGetId("iBlue")).on("keyup",this.updateFromIRGB.createDelegate(this),{buffer:750});Ext.getCmp(this.cpGetId("iHue")).on("keyup",this.updateFromIHSV.createDelegate(this),{buffer:750});Ext.getCmp(this.cpGetId("iSat")).on("keyup",this.updateFromIHSV.createDelegate(this),{buffer:750});Ext.getCmp(this.cpGetId("iVal")).on("keyup",this.updateFromIHSV.createDelegate(this),{buffer:750});Ext.getCmp(this.cpGetId("iHexa")).on("keyup",this.updateFromIHexa.createDelegate(this),{buffer:750});var a=Ext.getCmp(this.cpGetId("cCont")).body;if(this.showWebSafeColorbox===true){Ext.DomHelper.append(a,{cls:"x-cp-colorbox",id:this.cpGetId("cWebSafe")},true).update("Websafe");Ext.get(this.cpGetId("cWebSafe")).on("click",this.updateFromBox.createDelegate(this))}if(this.showInverseColorbox===true){Ext.DomHelper.append(a,{cls:"x-cp-colorbox",id:this.cpGetId("cInverse")},true).update("Inverse");Ext.get(this.cpGetId("cInverse")).on("click",this.updateFromBox.createDelegate(this))}if(this.showColorbox===true){Ext.DomHelper.append(a,{cls:"x-cp-colorbox",id:this.cpGetId("cColor")},true);Ext.get(this.cpGetId("cColor")).on("click",this.selectColor.createDelegate(this))}Ext.DomHelper.append(this.body,{tag:"br",cls:"x-cp-clearfloat"})},cpGetId:function(a){return this.getId()+"__"+(a||"cp")},updateRGBPosition:function(a,b){this.updateMode="click";a=a<0?0:a;a=a>181?181:a;b=b<0?0:b;b=b>181?181:b;this.HSV.s=this.getSaturation(a);this.HSV.v=this.getValue(b);Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+a-7,Ext.get(this.cpGetId("rgb")).getTop()+b-7,(this.animateMove||true));this.updateColor()},updateHUEPosition:function(a){this.updateMode="click";a=a<1?1:a;a=a>181?181:a;this.HSV.h=Math.round(360/181*(181-a));Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+a-7,(this.animateMove||true));this.updateRGBPicker(this.HSV.h);this.updateColor()},clickRGBPicker:function(b,a){this.updateRGBPosition(b.xy[0]-Ext.get(this.cpGetId("rgb")).getLeft(),b.xy[1]-Ext.get(this.cpGetId("rgb")).getTop())},clickHUEPicker:function(b,a){this.updateHUEPosition(b.xy[1]-Ext.get(this.cpGetId("hue")).getTop())},moveRGBPicker:function(a){this.rgbDD.constrainTo(this.cpGetId("rgb"),-7);this.updateRGBPosition(Ext.get(this.rgbPicker).getLeft()-Ext.get(this.cpGetId("rgb")).getLeft()+7,Ext.get(this.rgbPicker).getTop()-Ext.get(this.cpGetId("rgb")).getTop()+7)},moveHuePicker:function(a){this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:-3,bottom:-7,left:-3});this.updateHUEPosition(Ext.get(this.huePicker).getTop()-Ext.get(this.cpGetId("hue")).getTop()+7)},updateRGBPicker:function(a){this.updateMode="click";Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(a,1,1))});this.updateColor()},updateColor:function(){var b=this.hsvToRgb(this.HSV.h,this.HSV.s,this.HSV.v);var c=this.websafe(b);var d=this.invert(b);var a=this.invert(c);if(this.updateMode!=="hexa"){Ext.getCmp(this.cpGetId("iHexa")).setValue(this.rgbToHex(b))}if(this.updateMode!=="rgb"){Ext.getCmp(this.cpGetId("iRed")).setValue(b[0]);Ext.getCmp(this.cpGetId("iGreen")).setValue(b[1]);Ext.getCmp(this.cpGetId("iBlue")).setValue(b[2])}if(this.updateMode!=="hsv"){Ext.getCmp(this.cpGetId("iHue")).setValue(Math.round(this.HSV.h));Ext.getCmp(this.cpGetId("iSat")).setValue(Math.round(this.HSV.s*100));Ext.getCmp(this.cpGetId("iVal")).setValue(Math.round(this.HSV.v*100))}if(this.showColorbox===true){Ext.get(this.cpGetId("cColor")).setStyle({background:"#"+this.rgbToHex(b),color:"#"+this.rgbToHex(d)})}if(this.showInverseColorbox===true){Ext.get(this.cpGetId("cInverse")).setStyle({background:"#"+this.rgbToHex(d),color:"#"+this.rgbToHex(b)})}if(this.showWebSafeColorbox===true){Ext.get(this.cpGetId("cWebSafe")).setStyle({background:"#"+this.rgbToHex(c),color:"#"+this.rgbToHex(a)})}if(this.updateMode!=="click"){Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+this.getHPos(Ext.getCmp(this.cpGetId("iHue")).getValue())-7,(this.animateMove||true));Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+this.getSPos(Ext.getCmp(this.cpGetId("iSat")).getValue()/100)-7,Ext.get(this.cpGetId("hue")).getTop()+this.getVPos(Ext.getCmp(this.cpGetId("iVal")).getValue()/100)-7,(this.animateMove||true))}Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(Ext.getCmp(this.cpGetId("iHue")).getValue(),1,1))});this.selectColor()},setColor:function(a){if(!/^[0-9a-fA-F]{6}$/.test(a)){return}Ext.getCmp(this.cpGetId("iHexa")).setValue(a);this.updateFromIHexa()},getColor:function(){return Ext.getCmp(this.cpGetId("iHexa")).getValue()},updateFromIRGB:function(b,d,c){this.updateMode="rgb";var a=this.rgbToHsv(Ext.getCmp(this.cpGetId("iRed")).getValue(),Ext.getCmp(this.cpGetId("iGreen")).getValue(),Ext.getCmp(this.cpGetId("iBlue")).getValue());this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},updateFromIHSV:function(a,c,b){this.updateMode="hsv";this.HSV={h:Ext.getCmp(this.cpGetId("iHue")).getValue(),s:Ext.getCmp(this.cpGetId("iSat")).getValue()/100,v:Ext.getCmp(this.cpGetId("iVal")).getValue()/100};this.updateColor()},updateFromIHexa:function(b,d){var c=Ext.getCmp(this.cpGetId("iHexa")).getValue();if(!/^[0-9a-fA-F]{6}$/.test(c)){return}this.updateMode="hexa";var a=this.rgbToHsv(this.hexToRgb(c));this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},updateFromBox:function(c,b){this.updateMode="click";var a=this.rgbToHsv(this.hexToRgb(Ext.get(b).getColor("backgroundColor","","")));this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},selectColor:function(b,a){this.fireEvent("select",this,this.getColor())},hsvToRgb:function(j,u,n){if(j instanceof Array){return this.hsvToRgb.call(this,j[0],j[1],j[2])}var a,k,m,e,l,d,c,o;e=Math.floor((j/60)%6);l=(j/60)-e;d=n*(1-u);c=n*(1-l*u);o=n*(1-(1-l)*u);switch(e){case 0:a=n;k=o;m=d;break;case 1:a=c;k=n;m=d;break;case 2:a=d;k=n;m=o;break;case 3:a=d;k=c;m=n;break;case 4:a=o;k=d;m=n;break;case 5:a=n;k=d;m=c;break}return[this.realToDec(a),this.realToDec(k),this.realToDec(m)]},rgbToHsv:function(a,e,f){if(a instanceof Array){return this.rgbToHsv.call(this,a[0],a[1],a[2])}a=a/255;e=e/255;f=f/255;var c,i,k,d,l,j;c=Math.min(Math.min(a,e),f);i=Math.max(Math.max(a,e),f);k=i-c;switch(i){case c:d=0;break;case a:d=60*(e-f)/k;if(e<f){d+=360}break;case e:d=(60*(f-a)/k)+120;break;case f:d=(60*(a-e)/k)+240;break}l=(i===0)?0:1-(c/i);return[Math.round(d),l,i]},realToDec:function(a){return Math.min(255,Math.round(a*256))},rgbToHex:function(d,c,a){if(d instanceof Array){return this.rgbToHex.call(this,d[0],d[1],d[2])}return this.decToHex(d)+this.decToHex(c)+this.decToHex(a)},decToHex:function(b){var a="0123456789ABCDEF";b=parseInt(b,10);b=(!isNaN(b))?b:0;b=(b>255||b<0)?0:b;return a.charAt((b-b%16)/16)+a.charAt(b%16)},getHCharPos:function(b){var a="0123456789ABCDEF";return a.indexOf(b.toUpperCase())},hexToDec:function(b){var a=b.split("");return((this.getHCharPos(a[0])*16)+this.getHCharPos(a[1]))},hexToRgb:function(a){return[this.hexToDec(a.substr(0,2)),this.hexToDec(a.substr(2,2)),this.hexToDec(a.substr(4,2))]},getHue:function(b){var a=360-Math.round(((181-b)/181)*360);return a===360?0:a},getHPos:function(a){return 181-a*(181/360)},getSaturation:function(a){return a/181},getSPos:function(a){return a*181},getValue:function(a){return(181-a)/181},getVPos:function(a){return 181-(a*181)},checkSafeNumber:function(a){if(!isNaN(a)){a=Math.min(Math.max(0,a),255);var b,c;for(b=0;b<256;b=b+51){c=b+51;if(a>=b&&a<=c){return(a-b>25)?c:b}}}return a},websafe:function(d,c,a){if(d instanceof Array){return this.websafe.call(this,d[0],d[1],d[2])}return[this.checkSafeNumber(d),this.checkSafeNumber(c),this.checkSafeNumber(a)]},invert:function(d,c,a){if(d instanceof Array){return this.invert.call(this,d[0],d[1],d[2])}return[255-d,255-c,255-a]}});Ext.ux.ColorDialog=Ext.extend(Ext.Window,{constructor:function(a){a=a||{};Ext.applyIf(a,{buttons:[{handler:this.onOk,scope:this,text:"Ok"},{handler:this[this.closeAction].createDelegate(this,[]),scope:this,text:"Cancel"}]});Ext.ux.ColorDialog.superclass.constructor.apply(this,[a])},initComponent:function(){this.width=(!this.width||this.width<353)?353:this.width;this.applyDefaultsCP();Ext.ux.ColorDialog.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorDialog.superclass.onRender.apply(this,arguments);this.renderComponent()},onOk:function(){if(this.callback&&this.scope){this.callback.call(this.scope,this.getColor())}this[this.closeAction]()},show:function(c,a,b){if(!this.rendered){this.render(Ext.getBody())}if(this.hidden===false){this.toFront();return}if(this.fireEvent("beforeshow",this)===false){return}if(a){this.callback=a}if(b){this.scope=b}this.hidden=false;this.beforeShow();this.afterShow();c=c||"000000";this.setColor(c)}});Ext.applyIf(Ext.ux.ColorDialog.prototype,Ext.ux.ColorPicker.prototype);Ext.ux.ColorPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.width=(!this.width||this.width<300)?300:this.width;this.applyDefaultsCP();Ext.ux.ColorPanel.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorPanel.superclass.onRender.apply(this,arguments);this.renderComponent()}});Ext.applyIf(Ext.ux.ColorPanel.prototype,Ext.ux.ColorPicker.prototype);Ext.reg("colorpicker",Ext.ux.ColorPicker);Ext.reg("colordialog",Ext.ux.ColorDialog);Ext.reg("colorpanel",Ext.ux.ColorPanel);Ext.ux.menu.ColorItem=function(a){if(!a){a={}}a.style="width:350px;";Ext.ux.menu.ColorItem.superclass.constructor.call(this,new Ext.ux.ColorPicker(a),a);this.picker=this.component;this.addEvents("select");this.picker.on("render",function(b){b.getEl().swallowEvent("click")});this.picker.on("select",this.onSelect,this)};Ext.extend(Ext.ux.menu.ColorItem,Ext.menu.Adapter,{onSelect:function(b,a){this.fireEvent("select",this,a,b);Ext.ux.menu.ColorItem.superclass.handleClick.call(this)}});Ext.ux.menu.ColorMenu=function(a){Ext.ux.menu.ColorMenu.superclass.constructor.call(this,a);this.plain=true;var b=new Ext.ux.menu.ColorItem(a);this.add(b);this.picker=b.picker;this.relayEvents(b,["select"])};Ext.extend(Ext.ux.menu.ColorMenu,Ext.menu.Menu,{beforeDestroy:function(){this.picker.destroy()}});Ext.override(Ext.data.Connection,{handleResponse:function(a){if(a.responseText.indexOf("session_timeout")!=-1){Ext.MessageBox.alert(TocLanguage.msgWarningTitle,TocLanguage.msgSessionTimeout);window.location="index.php?login&action=logoff"}else{this.transId=false;var b=a.argument.options;a.argument=b?b.argument:null;this.fireEvent("requestcomplete",this,a,b);Ext.callback(b.success,b.scope,[a,b]);Ext.callback(b.callback,b.scope,[b,true,a])}}});Ext.namespace("Ext.ux.form");Ext.ux.form.StaticTextField=function(a){this.name=a.name||a.id;Ext.ux.form.StaticTextField.superclass.constructor.call(this,a)};Ext.extend(Ext.ux.form.StaticTextField,Ext.BoxComponent,{defaultAutoCreate:{tag:"div"},fieldClass:"x-form-item-label",isFormField:true,submitValue:false,value:undefined,encodeHtml:false,disableReset:false,field:null,getName:function(){return this.name},onRender:function(c,a){Ext.ux.form.StaticTextField.superclass.onRender.call(this,c,a);if(!this.el){var b=this.getAutoCreate();this.el=c.createChild(b,a);if(this.submitValue){this.field=c.createChild({tag:"input",type:"hidden",name:this.getName(),id:""},a)}}this.el.addClass([this.fieldClass,this.cls,"ux-form-statictextfield"]);this.initValue()},afterRender:function(b,a){Ext.ux.form.StaticTextField.superclass.afterRender.call(this);this.initEvents()},initValue:function(){if(this.value!==undefined){this.setValue(this.value)}else{if(this.el.dom.innerHTML.length>0){this.setValue(this.el.dom.innerHTML)}}},isDirty:function(){return false},reset:function(a){if(!this.disableReset||a===true){this.setValue(this.originalValue)}},initEvents:function(){this.originalValue=this.getRawValue()},isValid:function(){return true},validate:function(){return true},processValue:function(a){return a},validateValue:function(a){return true},markInvalid:function(){return},clearInvalid:function(){return},getRawValue:function(){return(this.rendered)?this.value:null},getValue:function(){return this.getRawValue()},setRawValue:function(a){this.value=a;if(this.rendered){this.el.dom.innerHTML=a;if(this.field){this.field.dom.value=a}}},setValue:function(a){this.value=a;if(this.rendered){if(this.encodeHtml==true){this.el.dom.innerHTML=Ext.util.Format.htmlEncode(a)}else{this.el.dom.innerHTML=a}if(this.field){this.field.dom.value=a}}}});Ext.reg("statictextfield",Ext.ux.form.StaticTextField);Array.prototype.contains=function(a){return this.indexOf(a)!==-1};Ext.namespace("Ext.ux");Ext.ux.DDView=function(b){if(!b.itemSelector){var a=b.tpl;if(this.classRe.test(a)){b.tpl=a.replace(this.classRe,"class=$1x-combo-list-item $2$1")}else{b.tpl=a.replace(this.tagRe,'$1 class="x-combo-list-item" $2')}b.itemSelector=".x-combo-list-item"}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(b,{border:false}))};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","))}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","))}if(this.deletable){this.setDeletable()}this.isDirtyFlag=false;this.addEvents("drop")},validate:function(){return true},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy()}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy()}}},getName:function(){return this.name},setValue:function(a){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store"}var b={};b[this.store.reader.meta.root]=a?[].concat(a):[];this.store.proxy=new Ext.data.MemoryProxy(b);this.store.load()},getValue:function(){var a="(";this.store.each(function(b){a+=b.id+","});return a.substr(0,a.length-1)+")"},getIds:function(){var b=0,a=new Array(this.store.getCount());this.store.each(function(c){a[b++]=c.id});return a},isDirty:function(){return this.isDirtyFlag},getTargetFromEvent:function(b){var a=b.getTarget();while((a!==null)&&(a.parentNode!=this.el.dom)){a=a.parentNode}if(!a){a=this.el.dom.lastChild||this.el.dom}return a},getDragData:function(d){var c=this.findItemFromChild(d.getTarget());if(c){if(!this.isSelected(c)){delete this.ignoreNextClick;this.onItemClick(c,this.indexOf(c),d);this.ignoreNextClick=true}var b={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&d.ctrlKey)};if(this.getSelectionCount()==1){var a=this.getSelectedIndexes()[0];var f=this.getNode(a);b.viewNodes.push(b.ddel=f);b.records.push(this.store.getAt(a));b.repairXY=Ext.fly(f).getXY()}else{b.ddel=document.createElement("div");b.ddel.className="multi-proxy";this.collectSelection(b)}return b}return false},getRepairXY:function(a){return this.dragData.repairXY},collectSelection:function(b){b.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(c){var e=this.getNode(c);var d=e.cloneNode(true);d.id=Ext.id();b.ddel.appendChild(d);b.records.push(this.store.getAt(c));b.viewNodes.push(e)},this)}else{var a=0;this.store.each(function(d){if(this.isSelected(a)){var e=this.getNode(a);var c=e.cloneNode(true);c.id=Ext.id();b.ddel.appendChild(c);b.records.push(this.store.getAt(a));b.viewNodes.push(e)}a++},this)}},setDraggable:function(a){if(a instanceof Array){Ext.each(a,this.setDraggable,this);return}if(this.dragZone){this.dragZone.addToGroup(a)}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:a});if(!this.multiSelect){this.singleSelect=true}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag}},setDroppable:function(a){if(a instanceof Array){Ext.each(a,this.setDroppable,this);return}if(this.dropZone){this.dropZone.addToGroup(a)}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:a});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this)}},getDropPoint:function(g,j,d){if(j==this.el.dom){return"above"}var f=Ext.lib.Dom.getY(j),a=f+j.offsetHeight;var i=f+(a-f)/2;var h=Ext.lib.Event.getPageY(g);if(h<=i){return"above"}else{return"below"}},isValidDropPoint:function(b,e,a){if(!a.viewNodes||(a.viewNodes.length!=1)){return true}var c=a.viewNodes[0];if(c==e){return false}if((b=="below")&&(e.nextSibling==c)){return false}if((b=="above")&&(e.previousSibling==c)){return false}return true},onNodeEnter:function(d,a,c,b){if(this.highlightColor&&(b.sourceView!=this)){this.el.highlight(this.highlightColor)}return false},onNodeOver:function(h,a,g,d){var b=this.dropNotAllowed;var f=this.getDropPoint(g,h,a);if(this.isValidDropPoint(f,h,d)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below"}if(f){var c;if(f=="above"){b=h.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";c="x-view-drag-insert-above"}else{b=h.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";c="x-view-drag-insert-below"}if(this.lastInsertClass!=c){Ext.fly(h).replaceClass(this.lastInsertClass,c);this.lastInsertClass=c}}}return b},onNodeOut:function(d,a,c,b){this.removeDropIndicators(d)},onNodeDrop:function(c,k,h,f){if(this.fireEvent("drop",this,c,k,h,f)===false){return false}var l=this.getDropPoint(h,c,k);var d=(this.appendOnly||(c==this.el.dom))?this.store.getCount():c.viewIndex;if(l=="below"){d++}if(f.sourceView==this){if(l=="below"){if(f.viewNodes[0]==c){f.viewNodes.shift()}}else{if(f.viewNodes[f.viewNodes.length-1]==c){f.viewNodes.pop()}}if(!f.viewNodes.length){return false}if(d>this.store.indexOf(f.records[0])){d--}}if(f.node instanceof Ext.tree.TreeNode){var a=f.node.getOwnerTree().recordFromNode(f.node);if(a){f.records=[a]}}if(!f.records){alert("Programming problem. Drag data contained no Records");return false}for(var g=0;g<f.records.length;g++){var a=f.records[g];var b=this.store.getById(a.id);if(b&&(k!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(b))).frame("red",1);return true}var j=new Ext.data.Record();a.id=j.id;delete j}if(f.copy){this.store.insert(d++,a.copy())}else{if(f.sourceView){f.sourceView.isDirtyFlag=true;f.sourceView.store.remove(a)}if(!this.allowTrash){this.store.insert(d++,a)}}if(this.sortField){this.store.sort(this.sortField,this.sortDir)}this.isDirtyFlag=true}this.dragZone.cachedTarget=null;return true},onEndDrag:function(a,b){var c=Ext.get(this.dragData.ddel);if(c&&c.hasClass("multi-proxy")){c.remove()}},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass"}},setDeletable:function(a){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true}var b=this.getContextMenu();this.contextMenu.on("itemclick",function(c){switch(c.id){case"delete":this.remove(this.getSelectedIndexes());break}},this);this.contextMenu.add({icon:a||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")})},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this)}return this.contextMenu},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this)}},showContextMenu:function(b,a){a=this.findItemFromChild(b.getTarget());if(a){b.stopEvent();this.select(this.getNode(a),this.multiSelect&&b.ctrlKey,true);this.contextMenu.showAt(b.getXY())}},remove:function(b){b=[].concat(b);for(var a=0;a<b.length;a++){var c=this.store.getAt(b[a]);this.store.remove(c)}},onDblClick:function(f){var d=this.findItemFromChild(f.getTarget());if(d){if(this.fireEvent("dblclick",this,this.indexOf(d),d,f)===false){return false}if(this.dragGroup){var a=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(a.contains(this.dropZone)){a.remove(this.dropZone)}if((a.length==1)&&(a[0].owningView)){this.dragZone.cachedTarget=null;var b=Ext.get(a[0].getEl());var c=b.getBox(true);a[0].onNodeDrop(b.dom,{target:b.dom,xy:[c.x,c.y+c.height-1]},null,this.getDragData(f))}}}},onItemClick:function(b,a,c){if(this.ignoreNextClick){delete this.ignoreNextClick;return}if(this.fireEvent("beforeclick",this,a,b,c)===false){return false}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&c.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),a),false)}else{if(this.isSelected(b)&&c.ctrlKey){this.deselect(b)}else{this.deselect(b);this.select(b,this.multiSelect&&c.ctrlKey);this.lastSelection=b}}c.preventDefault()}return true}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({dblclick:true,click:true,change:true,drop:true})},onRender:function(e,b){var a,c,d;Ext.ux.Multiselect.superclass.onRender.call(this,e,b);c="ux-mselect";a=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});if(!this.legend){a.el.down("."+a.headerCls).remove()}a.body.addClass(c);d='<tpl for="."><div class="'+c+"-item";if(Ext.isIE||Ext.isIE7){d+='" unselectable=on'}else{d+=' x-unselectable"'}d+=">{"+this.displayField+"}</div></tpl>";if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:c+"-selected",tpl:d,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+c+"-item",isFormField:false,applyTo:a.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});a.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(h,k,g,j,i){return this.fireEvent("drop",h,k,g,j,i)},this);this.hiddenName=this.name;var f={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(f)}else{this.hiddenField=Ext.get(document.body).createChild(f)}a.doLayout()},initValue:Ext.emptyFn,onViewClick:function(d,b,c,f){var a=this.preClickSelections.indexOf(b);if(a!=-1){this.preClickSelections.splice(a,1);this.view.clearSelections(true);this.view.select(this.preClickSelections)}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,f);this.validate()},onViewBeforeClick:function(c,a,b,d){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false}},onViewDblClick:function(c,a,b,d){return this.fireEvent("dblclick",c,a,b,d)},getValue:function(a){var d=[];var c=this.view.getSelectedIndexes();if(c.length==0){return""}for(var b=0;b<c.length;b++){d.push(this.store.getAt(c[b]).get(((a!=null)?a:this.valueField)))}return d.join(this.delimiter)},setValue:function(a){var b;var d=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!a||(a=="")){return}if(!(a instanceof Array)){a=a.split(this.delimiter)}for(var c=0;c<a.length;c++){b=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+a[c]+"$","i")).itemAt(0));d.push(b)}this.view.select(d);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue("")},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter)}else{b=[]}return b},setRawValue:function(a){setValue(a)},validateValue:function(a){if(a.length<1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(a.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(a.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}return true}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,allowDup:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({rowdblclick:true,change:true})},onRender:function(d,a){Ext.ux.ItemSelector.superclass.onRender.call(this,d,a);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.allowDup,copy:this.allowDup,allowTrash:this.allowDup,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir,style:"margin-bottom: 10px"});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.allowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.toSortField,sortDir:this.toSortDir,style:"margin-bottom: 10px"});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var g=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});g.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var c=new Ext.Panel({header:false});g.add(c);g.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);g.render(this.el);c.el.down("."+c.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var f=c.getEl();if(!this.toSortField){this.toTopIcon=f.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.upIcon=f.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"})}this.addIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.removeIcon=f.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});if(!this.toSortField){this.downIcon=f.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});f.createChild({tag:"br"});this.toBottomIcon=f.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this)}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none"}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none"}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none"}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none"}var b=g.body.first();this.el.setWidth(g.body.first().getWidth());g.body.removeClass();this.hiddenName=this.name;var e={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(e);this.valueChanged(this.toStore)},initValue:Ext.emptyFn,toTop:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=a.length-1;b>-1;b--){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);c.push(((a.length-1)-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},toBottom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){c.sort();for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);c.push((this.toMultiselect.view.store.getCount())-(a.length-b))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(c)},up:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]-1)>=0){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]-1,a);d.push(c[b]-1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},down:function(){var a=null;var c=this.toMultiselect.view.getSelectedIndexes();c.sort();c.reverse();var d=[];if(c.length>0){for(var b=0;b<c.length;b++){a=this.toMultiselect.view.store.getAt(c[b]);if((c[b]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(a);this.toMultiselect.view.store.insert(c[b]+1,a);d.push(c[b]+1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(d)}},fromTo:function(){var d=this.fromMultiselect.view.getSelectedIndexes();var b=[];if(d.length>0){for(var c=0;c<d.length;c++){record=this.fromMultiselect.view.store.getAt(d[c]);b.push(record)}if(!this.allowDup){d=[]}for(var c=0;c<b.length;c++){record=b[c];if(this.allowDup){var a=new Ext.data.Record();record.id=a.id;delete a;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);d.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)}if(this.allowDup){this.fromMultiselect.view.select(d)}else{this.toMultiselect.view.select(d)}},toFrom:function(){var c=this.toMultiselect.view.getSelectedIndexes();var a=[];if(c.length>0){for(var b=0;b<c.length;b++){record=this.toMultiselect.view.store.getAt(c[b]);a.push(record)}c=[];for(var b=0;b<a.length;b++){record=a[b];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);c.push((this.fromMultiselect.view.store.getCount()-1))}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)}this.fromMultiselect.view.select(c)},valueChanged:function(c){var a=null;var b=[];for(var d=0;d<c.getCount();d++){a=c.getAt(d);b.push(a.get(this.valueField))}this.hiddenField.dom.value=b.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value},onRowDblClick:function(c,a,b,d){return this.fireEvent("rowdblclick",c,a,b,d)},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.allowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC")}this.valueChanged(this.toMultiselect.store)}});Ext.reg("itemselector",Ext.ux.ItemSelector);Ext.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(c,a){Ext.form.FileUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.fileInput.on("change",function(){var d=this.fileInput.dom.value;this.setValue(d);this.fireEvent("fileselected",this,d)},this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){Ext.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}});Ext.reg("fileuploadfield",Ext.form.FileUploadField);Ext.ns("Ext.ux.grid");if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}Ext.ux.grid.RowActions=function(a){Ext.apply(this,a);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,dataIndex:"",header:"",menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',hideMode:"visiblity",widthIntercept:4,widthSlope:25,init:function(c){this.grid=c;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true}var b=c.getView();var a={scope:this};a[this.actionEvent]=this.onClick;c.afterRender=c.afterRender.createSequence(function(){b.mainBody.on(a)},this);if(!this.renderer){this.renderer=function(h,d,e,i,g,f){d.css+=(d.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(h,d,e,i,g,f))}.createDelegate(this)}if(b.groupTextTpl&&this.groupActions){b.interceptMouse=b.interceptMouse.createInterceptor(function(d){if(d.getTarget(".ux-grow-action-item")){return false}});b.groupTextTpl='<div class="ux-grow-action-text">'+b.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}},getData:function(e,a,b,f,d,c){return b.data||{}},processActions:function(d,c){var a=[];Ext.each(d,function(e,f){if(e.iconCls&&"function"===typeof(e.callback||e.cb)){this.callbacks=this.callbacks||{};this.callbacks[e.iconCls]=e.callback||e.cb}var g={cls:e.iconIndex?"{"+e.iconIndex+"}":(e.iconCls?e.iconCls:""),qtip:e.qtipIndex?"{"+e.qtipIndex+"}":(e.tooltip||e.qtip?e.tooltip||e.qtip:""),text:e.textIndex?"{"+e.textIndex+"}":(e.text?e.text:""),hide:e.hideIndex?'<tpl if="'+e.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(e.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:e.align||"right",style:e.style?e.style:""};a.push(g)},this);var b=new Ext.XTemplate(c||this.tplRow);return new Ext.XTemplate(b.apply({actions:a}))},onClick:function(g,h){var i=this.grid.getView();var c=false;var m=g.getTarget(".x-grid3-row");var a=i.findCellIndex(h.parentNode.parentNode);var l=g.getTarget(".ux-row-action-item");if(l){c=l.className.replace(/ux-row-action-item /,"");if(c){c=c.replace(/ ux-row-action-text/,"");c=c.trim()}}if(false!==m&&false!==a&&false!==c){var f=this.grid.store.getAt(m.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,f,c,m.rowIndex,a)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,f,c,m.rowIndex,a)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,f,c,m.rowIndex,a)}}}l=g.getTarget(".ux-grow-action-item");if(l){var j=i.findGroup(h);var d=j?j.id.replace(/ext-gen[0-9]+-gp-/,""):null;var b;if(d){var k=new RegExp(RegExp.escape(d));b=this.grid.store.queryBy(function(e){return e._groupId.match(k)});b=b?b.items:[]}c=l.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,b,c,d)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,b,c,d)){return false}this.fireEvent("groupaction",this.grid,b,c,d)}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);Ext.grid.RowExpander=function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}};Ext.extend(Ext.grid.RowExpander,Ext.util.Observable,{header:"",width:20,sortable:false,fixed:true,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",function(){a.mainBody.on("mousedown",this.onMouseDown,this)},this);this.grid.store.on({load:{fn:function(d,c,e){this.collapseAll(d.getCount())},scope:this}})},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];c=this.tpl.apply(a.data);this.bodyContent[a.id]=c;return c},onMouseDown:function(b,a){if(a.className=="x-grid3-row-expander"){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)}},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},afterEdit:function(d,b,c){var e=d.findBy(function(f,g){return(b===f)});var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",this.grid.view.getRow(e));if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,e)}},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}this.grid.store.addListener("update",this.afterEdit,this)},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforcollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}this.grid.store.removeListener("update",this.afterEdit,this)},collapseAll:function(b){for(var a=0;a<b;a++){this.collapseRow(a)}}});Ext.PageToolbar=Ext.extend(Ext.Toolbar,{pageSize:20,displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"No data to display",beforePageText:"Page",afterPageText:"of {0}",firstText:"First Page",prevText:"Previous Page",nextText:"Next Page",lastText:"Last Page",refreshText:"Refresh",prevStepText:"Previous Step",nextStepText:"Next Step",paramNames:{start:"start",limit:"limit"},btnsConfig:[],steps:5,pageConfig:{first:true,prev:true,next:true,last:true,loading:true,field:true,prevstep:true,nextstep:true,pagepanel:true,dispalyNum:true},initStep:function(){this.steps=this.steps},getHalfStep:function(){return parseInt(this.steps/2)},initComponent:function(){Ext.PageToolbar.superclass.initComponent.call(this);this.cursor=0;this.bind(this.store)},onRender:function(c,a){Ext.PageToolbar.superclass.onRender.call(this,c,a);this.initStep();for(var b=0;b<=this.btnsConfig.length-1;b++){this.btngroup=this.addButton({text:this.btnsConfig[b].text,tooltip:this.btnsConfig[b].tooltip,iconCls:this.btnsConfig[b].iconCls,handler:this.btnsConfig[b].handler});this.addSeparator()}this.first=this.addButton({tooltip:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.onClick.createDelegate(this,["first"])});this.firstbar=this.addSeparator();this.prevstep=this.addButton({tooltip:this.prevStepText,iconCls:"x-tbar-page-prevstep",disabled:true,handler:this.onClick.createDelegate(this,["prevstep"])});this.prevstepbar=this.addSeparator();this.prev=this.addButton({tooltip:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.onClick.createDelegate(this,["prev"])});this.prevbar=this.addSeparator();for(var d=1;d<=this.steps;d++){this.pagePanel=this.addButton({id:this.id+"_btn"+d,text:"",handler:this.onClick.createDelegate(this,["jump",d])})}this.pagepanelbar=this.addSeparator();this.beforeTextEl=this.add(this.beforePageText);this.field=Ext.get(this.addDom({tag:"input",type:"text",size:"3",value:"1",cls:"x-tbar-page-number"}).el);this.field.on("keydown",this.onPagingKeydown,this);this.field.on("focus",function(){this.dom.select()});this.afterTextEl=this.addText(String.format(this.afterPageText,1));this.field.setHeight(18);this.fieldbar=this.addSeparator();this.next=this.addButton({tooltip:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.onClick.createDelegate(this,["next"])});this.nextbar=this.addSeparator();this.nextstep=this.addButton({tooltip:this.nextStepText,iconCls:"x-tbar-page-nextstep",disabled:true,handler:this.onClick.createDelegate(this,["nextstep"])});this.nextstepbar=this.addSeparator();this.last=this.addButton({tooltip:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.onClick.createDelegate(this,["last"])});this.nextstepbar=this.addSeparator();this.displayNum=this.addItem(new Ext.form.ComboBox({triggerAction:"all",store:new Ext.data.SimpleStore({fields:["text"],data:[["5"],["10"],["20"],["30"],["40"],["50"]]}),displayField:"text",valueField:"text",mode:"local",readOnly:true,value:this.pageSize,width:40,listeners:{select:this.onClick.createDelegate(this,["displaynum"]),scope:this}}));this.lastbar=this.addSeparator();this.loading=this.addButton({tooltip:this.refreshText,iconCls:"x-tbar-loading",handler:this.onClick.createDelegate(this,["refresh"])});if(this.displayInfo){this.displayEl=Ext.fly(this.el.dom).createChild({cls:"x-paging-info"})}if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)}},updateInfo:function(){if(this.displayEl){var a=this.store.getCount();var b=a==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+a,this.store.getTotalCount());this.displayEl.update(b)}},onLoad:function(a,e,h){if(!this.rendered){this.dsLoaded=[a,e,h];return}this.initStep();this.cursor=h.params?h.params[this.paramNames.start]:0;var g=this.getPageData(),c=g.activePage,f=g.pages;if(f<=this.steps){for(var i=1;i<=f;i++){Ext.getCmp(this.id+"_btn"+i).setText(i);if(c==i){Ext.getCmp(this.id+"_btn"+i).el.child("button").setStyle({"font-weight":"bold"})}else{Ext.getCmp(this.id+"_btn"+i).el.child("button").setStyle({background:"","font-weight":"normal"})}Ext.getCmp(this.id+"_btn"+i).handler=this.onClick.createDelegate(this,["jump",i])}for(var i=1;i<=this.steps;i++){if(i<=f){Ext.getCmp(this.id+"_btn"+i).setDisabled(false)}else{Ext.getCmp(this.id+"_btn"+i).setText("");Ext.getCmp(this.id+"_btn"+i).setDisabled(true)}}}else{for(var i=1,b=(c-this.getHalfStep())>=1?(c-this.getHalfStep()):1;i<=this.steps;i++,b++){Ext.getCmp(this.id+"_btn"+i).setText(b);if(c==b){Ext.getCmp(this.id+"_btn"+i).el.child("button").setStyle({"font-weight":"bold"})}else{Ext.getCmp(this.id+"_btn"+i).el.child("button").setStyle({background:"","font-weight":"normal"})}Ext.getCmp(this.id+"_btn"+i).handler=this.onClick.createDelegate(this,["jump",b]);if(c+i-this.getHalfStep()-2>=f){Ext.getCmp(this.id+"_btn"+i).setDisabled(true);Ext.getCmp(this.id+"_btn"+i).setText("")}else{Ext.getCmp(this.id+"_btn"+i).setDisabled(false)}}}this.field.dom.value=c;this.first.setDisabled(c==1);this.prev.setDisabled(c==1);this.next.setDisabled(c==f);this.last.setDisabled(c==f);this.prevstep.setDisabled(c<this.steps);this.nextstep.setDisabled(c>f-this.steps);this.loading.enable();this.updateInfo();this.first.setVisible(this.pageConfig.first);this.firstbar.setVisible(this.pageConfig.first);this.prev.setVisible(this.pageConfig.prev);this.prevbar.setVisible(this.pageConfig.prev);this.prevstep.setVisible(this.pageConfig.prev);this.prevstepbar.setVisible(this.pageConfig.prev);this.next.setVisible(this.pageConfig.next);this.nextbar.setVisible(this.pageConfig.next);this.last.setVisible(this.pageConfig.last);this.lastbar.setVisible(this.pageConfig.last);this.loading.setVisible(this.pageConfig.loading);this.field.setVisible(this.pageConfig.field);this.fieldbar.setVisible(this.pageConfig.field);this.prevstep.setVisible(this.pageConfig.prevstep);this.prevstepbar.setVisible(this.pageConfig.prevstep);this.nextstep.setVisible(this.pageConfig.nextstep);this.nextstepbar.setVisible(this.pageConfig.nextstep);this.displayNum.setVisible(this.pageConfig.dispalyNum);this.nextstepbar.setVisible(this.pageConfig.dispalyNum);this.pagepanelbar.setVisible(this.pageConfig.pagepanel)},getPageData:function(){var a=this.store.getTotalCount();return{total:a,activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}},onLoadError:function(){if(!this.rendered){return}this.loading.enable()},readPage:function(c){var a=this.field.dom.value,b;if(!a||isNaN(b=parseInt(a,10))){this.field.dom.value=c.activePage;return false}return b},onPagingKeydown:function(f){var b=f.getKey(),g=this.getPageData(),c;if(b==f.RETURN){f.stopEvent();if(c=this.readPage(g)){c=Math.min(Math.max(1,c),g.pages)-1;this.doLoad(c*this.pageSize)}}else{if(b==f.HOME||b==f.END){f.stopEvent();c=b==f.HOME?1:g.pages;this.field.dom.value=c}else{if(b==f.UP||b==f.PAGEUP||b==f.DOWN||b==f.PAGEDOWN){f.stopEvent();if(c=this.readPage(g)){var a=f.shiftKey?10:1;if(b==f.DOWN||b==f.PAGEDOWN){a*=-1}c+=a;if(c>=1&c<=g.pages){this.field.dom.value=c}}}}}},beforeLoad:function(){if(this.rendered&&this.loading){this.loading.disable()}},doLoad:function(c){var b={},a=this.paramNames;b[a.start]=c;b[a.limit]=this.pageSize;this.store.load({params:b})},displaynum:function(c){this.pageSize=parseInt(this.displayNum.getValue());var b={},a=this.paramNames;b[a.start]=c;b[a.limit]=this.pageSize;this.store.load({params:b})},onClick:function(f,e){var b=this.store;switch(f){case"first":this.doLoad(0);break;case"prev":this.doLoad(Math.max(0,this.cursor-this.pageSize));break;case"next":this.doLoad(this.cursor+this.pageSize);break;case"last":var d=b.getTotalCount();var a=d%this.pageSize;var c=a?(d-a):d-this.pageSize;this.doLoad(c);break;case"refresh":this.doLoad(this.cursor);break;case"jump":this.doLoad(this.pageSize*(e-1));break;case"prevstep":this.doLoad(this.cursor-this.steps*this.pageSize);break;case"nextstep":this.doLoad(this.cursor+this.steps*this.pageSize);break;case"displaynum":this.displaynum(0);break}},unbind:function(a){a=Ext.StoreMgr.lookup(a);a.un("beforeload",this.beforeLoad,this);a.un("load",this.onLoad,this);a.un("loadexception",this.onLoadError,this);this.store=undefined},bind:function(a){a=Ext.StoreMgr.lookup(a);a.on("beforeload",this.beforeLoad,this);a.on("load",this.onLoad,this);a.on("loadexception",this.onLoadError,this);this.store=a}});Ext.reg("paging",Ext.PageToolbar);Ext.ns("Ext.ux.tree");Ext.ux.tree.CheckTreePanel=Ext.extend(Ext.tree.TreePanel,{bubbleCheck:"checked",cascadeCheck:"unchecked",deepestOnly:false,expandOnCheck:true,filter:true,separator:",",cls:"ux-checktree",baseAttrs:{},initComponent:function(){this.eventModel=new Ext.ux.tree.CheckTreeEventModel(this);Ext.ux.tree.CheckTreePanel.superclass.initComponent.apply(this,arguments);var a=Ext.apply({uiProvider:Ext.ux.tree.CheckTreeNodeUI},this.baseAttrs);Ext.applyIf(this.loader,{baseAttrs:a,preloadChildren:true});if(true===this.loader.preloadChildren){this.loader.on("load",function(c,d){d.cascade(function(e){c.doPreload(e);e.loaded=true})})}if(true===this.filter){var b=Ext.ux.tree.TreeFilterX?Ext.ux.tree.TreeFilterX:Ext.tree.TreeFilter;this.filter=new b(this,{autoClear:true})}},getValue:function(){var b=[];this.root.cascade(function(a){if(true===a.attributes.checked){if(false===this.deepestOnly||!this.isChildChecked(a)){b.push(a.id)}}},this);return b},isChildChecked:function(b){var a=false;Ext.each(b.childNodes,function(c){if(c.attributes.checked){a=true}});return a},clearValue:function(){this.root.cascade(function(b){var a=b.getUI();if(a&&a.setChecked){a.setChecked(false)}});this.value=[];return this},convertValue:function(d){var b=[];if(1<arguments.length){for(var c=0;c<arguments.length;c++){b.push(this.convertValue(arguments[c]))}}else{if(Ext.isArray(d)){b=d}else{if("number"===typeof d){b.push(d)}else{if("string"===typeof d){b=d.split(this.separator)}}}}return b},setValue:function(a){this.clearValue();this.value=this.convertValue.apply(this,arguments);Ext.each(this.value,function(d){var c=this.getNodeById(d);if(c){var b=c.getUI();if(b&&b.setChecked){b.setChecked(true);if(true===this.expandOnCheck){c.bubbleExpand()}}}},this);return this.value},serialize:function(b){b=b||"text";var c=[];this.root.cascade(function(a){if(true===a.attributes.checked){if(false===this.deepestOnly||!this.isChildChecked(a)){c.push(a[b])}}},this);return c.join(this.separator+" ")},getText:function(a){return this.serialize(a)},onRender:function(){Ext.ux.tree.CheckTreePanel.superclass.onRender.apply(this,arguments);if(true===this.isFormField){this.hiddenField=this.body.createChild({tag:"input",type:"hidden",name:this.name||this.id},undefined,true)}},updateHidden:function(){if(this.hiddenField){this.hiddenField.value=this.getValue().join(this.separator)}},clearInvalid:Ext.emptyFn,markInvalid:Ext.emptyFn,validate:function(){return true},isValid:function(){return true},getName:function(){return this.name||this.id||""}});Ext.reg("checktreepanel",Ext.ux.tree.CheckTreePanel);Ext.override(Ext.tree.TreeNode,{bubbleExpand:function(){var a=this.getOwnerTree().root;var b=[];var c=this;while(c!==a){c=c.parentNode;b.push(c)}b.reverse();Ext.each(b,function(d){d.expand(false,false)})}});Ext.ux.tree.CheckTreeNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{renderElements:function(e,h,g,j){this.indentMarkup=e.parentNode?e.parentNode.ui.getChildIndent():"";var i=e.attributes.checked;var c=h.href?h.href:Ext.isGecko?"":"#";var d=['<li class="x-tree-node"><div ext:tree-node-id="',e.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',h.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',h.icon||this.emptyIcon,'" class="x-tree-node-icon',(h.icon?" x-tree-node-inline-icon":""),(h.iconCls?" "+h.iconCls:""),'" unselectable="on" />','<img src="'+this.emptyIcon+'" class="x-tree-checkbox'+(true===i?" x-tree-node-checked":"")+'" />','<a hidefocus="on" class="x-tree-node-anchor" href="',c,'" tabIndex="1" ',h.hrefTarget?' target="'+h.hrefTarget+'"':"",'><span unselectable="on">',e.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");var b;if(j!==true&&e.nextSibling&&(b=e.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",b,d)}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",g,d)}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var f=this.elNode.childNodes;this.indentNode=f[0];this.ecNode=f[1];this.iconNode=f[2];this.checkbox=f[3];this.cbEl=Ext.get(this.checkbox);this.anchor=f[4];this.textNode=f[4].firstChild},setIconCls:function(a){Ext.fly(this.iconNode).set({cls:"x-tree-node-icon "+a})},isChecked:function(){return this.node.attributes.checked===true},onCheckChange:function(){var d=this.isChecked();var a=this.node.getOwnerTree();var b=a.bubbleCheck;var c=a.cascadeCheck;if("all"===b||(d&&"checked"===b)||(!d&&"unchecked"===b)){this.updateParent(d)}if("all"===c||(d&&"checked"===c)||(!d&&"unchecked"===c)){this.updateChildren(d)}a.updateHidden();this.fireEvent("checkchange",this.node,d)},setChecked:function(b){b=true===b?b:false;var a=this.cbEl||false;if(a){true===b?a.addClass("x-tree-node-checked"):a.removeClass("x-tree-node-checked")}this.node.attributes.checked=b;this.onCheckChange();return b},toggleCheck:function(){var a=!this.isChecked();this.setChecked(a);return a},updateParent:function(a){var c=this.node.parentNode;var b=c?c.getUI():false;if(b&&b.setChecked){b.setChecked(a)}},updateChildren:function(a){this.node.eachChild(function(c){var b=c.getUI();if(b&&b.setChecked){b.setChecked(a)}})},onCheckboxClick:function(){if(!this.disabled){this.toggleCheck()}},onCheckboxOver:function(){this.addClass("x-tree-checkbox-over")},onCheckboxOut:function(){this.removeClass("x-tree-checkbox-over")},onCheckboxDown:function(){this.addClass("x-tree-checkbox-down")},onCheckboxUp:function(){this.removeClass("x-tree-checkbox-down")}});Ext.ux.tree.CheckTreeEventModel=Ext.extend(Ext.tree.TreeEventModel,{initEvents:function(){var a=this.tree.getTreeEl();a.on("click",this.delegateClick,this);if(this.tree.trackMouseOver!==false){a.on("mouseover",this.delegateOver,this);a.on("mouseout",this.delegateOut,this)}a.on("mousedown",this.delegateDown,this);a.on("mouseup",this.delegateUp,this);a.on("dblclick",this.delegateDblClick,this);a.on("contextmenu",this.delegateContextMenu,this)},delegateOver:function(b,a){if(!this.beforeEvent(b)){return}if(this.lastEcOver){this.onIconOut(b,this.lastEcOver);delete this.lastEcOver}if(this.lastCbOver){this.onCheckboxOut(b,this.lastCbOver);delete this.lastCbOver}if(b.getTarget(".x-tree-ec-icon",1)){this.lastEcOver=this.getNode(b);this.onIconOver(b,this.lastEcOver)}else{if(b.getTarget(".x-tree-checkbox",1)){this.lastCbOver=this.getNode(b);this.onCheckboxOver(b,this.lastCbOver)}}if(a=this.getNodeTarget(b)){this.onNodeOver(b,this.getNode(b))}},delegateOut:function(b,a){if(!this.beforeEvent(b)){return}if(b.getTarget(".x-tree-ec-icon",1)){var c=this.getNode(b);this.onIconOut(b,c);if(c==this.lastEcOver){delete this.lastEcOver}}else{if(b.getTarget(".x-tree-checkbox",1)){var c=this.getNode(b);this.onCheckboxOut(b,c);if(c==this.lastCbOver){delete this.lastCbOver}}}if((a=this.getNodeTarget(b))&&!b.within(a,true)){this.onNodeOut(b,this.getNode(b))}},delegateDown:function(b,a){if(!this.beforeEvent(b)){return}if(b.getTarget(".x-tree-checkbox",1)){this.onCheckboxDown(b,this.getNode(b))}},delegateUp:function(b,a){if(!this.beforeEvent(b)){return}if(b.getTarget(".x-tree-checkbox",1)){this.onCheckboxUp(b,this.getNode(b))}},delegateOut:function(b,a){if(!this.beforeEvent(b)){return}if(b.getTarget(".x-tree-ec-icon",1)){var c=this.getNode(b);this.onIconOut(b,c);if(c==this.lastEcOver){delete this.lastEcOver}}else{if(b.getTarget(".x-tree-checkbox",1)){var c=this.getNode(b);this.onCheckboxOut(b,c);if(c==this.lastCbOver){delete this.lastCbOver}}}if((a=this.getNodeTarget(b))&&!b.within(a,true)){this.onNodeOut(b,this.getNode(b))}},delegateClick:function(b,a){if(!this.beforeEvent(b)){return}if(b.getTarget(".x-tree-checkbox",1)){this.onCheckboxClick(b,this.getNode(b))}else{if(b.getTarget(".x-tree-ec-icon",1)){this.onIconClick(b,this.getNode(b))}else{if(this.getNodeTarget(b)){this.onNodeClick(b,this.getNode(b))}}}},onCheckboxClick:function(b,a){a.ui.onCheckboxClick()},onCheckboxOver:function(b,a){a.ui.onCheckboxOver()},onCheckboxOut:function(b,a){a.ui.onCheckboxOut()},onCheckboxDown:function(b,a){a.ui.onCheckboxDown()},onCheckboxUp:function(b,a){a.ui.onCheckboxUp()}});Ext.util.Format.CurrencyFactory=function(e,a,c,b,d){return function(h){e=Math.abs(e)+1?e:2;a=a||".";c=c||",";d=d||null;var g=/(\d+)(?:(\.\d+)|)/.exec(h+""),f=g[1].length>3?g[1].length%3:0;return b+" "+(h<0?"-":"")+(f?g[1].substr(0,f)+c:"")+g[1].substr(f).replace(/(\d{3})(?=\d)/g,"$1"+c)+(e?a+(+g[2]||0).toFixed(e).substr(2):"")+((d!=null)?(" "+d):"")}};Ext.namespace("Ext.ux.layout");Ext.ux.layout.CardLayout=Ext.extend(Ext.layout.CardLayout,{setActiveItem:function(a){a=this.container.getComponent(a);if(this.activeItem!=a){if(this.activeItem){this.activeItem.hide()}if(this.activeItem&&!this.activeItem.hidden){return}this.activeItem=a;a.show();this.layout()}}});Ext.namespace("Ext.ux");Ext.ux.Wiz=Ext.extend(Ext.Window,{loadMaskConfig:{"default":"Saving..."},height:400,width:540,closable:true,resizable:false,modal:true,cards:null,previousButtonText:"&lt; Previous",nextButtonText:"Next &gt;",cancelButtonText:"Cancel",finishButtonText:"Finish",headerConfig:{},cardPanelConfig:{},previousButton:null,nextButton:null,cancelButton:null,cardPanel:null,currentCard:-1,headPanel:null,cardCount:0,initComponent:function(){this.initButtons();this.initPanels();var a=this.title||this.headerConfig.title;a=a||"";Ext.apply(this,{title:a,layout:"border",cardCount:this.cards.length,buttons:[this.previousButton,this.nextButton,this.cancelButton],items:[this.headPanel,this.cardPanel]});this.addEvents("cancel","finish");Ext.ux.Wiz.superclass.initComponent.call(this)},getWizardData:function(){var d={};var c=this.cards;for(var b=0,a=c.length;b<a;b++){if(c[b].form){d[c[b].id]=c[b].form.getValues(false)}else{d[c[b].id]={}}}return d},switchDialogState:function(a,c){this.showLoadMask(!a,c);this.previousButton.setDisabled(!a);this.nextButton.setDisabled(!a);this.cancelButton.setDisabled(true);var b=this.tools.close;if(b){switch(a){case true:this.tools.close.unmask();break;default:this.tools.close.mask();break}}this.closable=a},showLoadMask:function(a,b){if(!b){b="default"}if(a){if(this.loadMask==null){this.loadMask=new Ext.LoadMask(this.body)}this.loadMask.msg=this.loadMaskConfig[b];this.loadMask.show()}else{if(this.loadMask){this.loadMask.hide()}}},initEvents:function(){Ext.ux.Wiz.superclass.initEvents.call(this);this.on("beforeclose",this.onBeforeClose,this);var c=this.cards;for(var b=0,a=c.length;b<a;b++){c[b].on("show",this.onCardShow,this);c[b].on("hide",this.onCardHide,this);c[b].on("clientvalidation",this.onClientValidation,this)}},initPanels:function(){var b=this.cards;var a=this.cardPanelConfig;Ext.apply(this.headerConfig,{steps:b.length});this.headPanel=new Ext.ux.Wiz.Header(this.headerConfig);Ext.apply(a,{layout:new Ext.ux.layout.CardLayout(),items:b});Ext.applyIf(a,{region:"center",border:false,activeItem:0});this.cardPanel=new Ext.Panel(a)},initButtons:function(){this.previousButton=new Ext.Button({text:this.previousButtonText,disabled:true,minWidth:75,handler:this.onPreviousClick,scope:this});this.nextButton=new Ext.Button({text:this.nextButtonText,minWidth:75,handler:this.onNextClick,scope:this});this.cancelButton=new Ext.Button({text:this.cancelButtonText,handler:this.onCancelClick,scope:this,minWidth:75})},onBeforeClose:function(a){return this.closable},onClientValidation:function(a,b){if(!b){this.nextButton.setDisabled(true)}else{this.nextButton.setDisabled(false)}},onCardHide:function(a){if(this.cardPanel.layout.activeItem.id===a.id){this.nextButton.setDisabled(true)}},onCardShow:function(c){var e=c.ownerCt;var b=e.items;for(var d=0,a=b.length;d<a;d++){if(b.get(d).id==c.id){break}}this.currentCard=d;this.headPanel.updateStep(d,c.title);if(d==a-1){this.nextButton.setText(this.finishButtonText)}else{this.nextButton.setText(this.nextButtonText)}if(c.isValid()){this.nextButton.setDisabled(false)}if(d==0){this.previousButton.setDisabled(true)}else{this.previousButton.setDisabled(false)}},onCancelClick:function(){if(this.fireEvent("cancel",this)!==false){this.close()}},onFinish:function(){if(this.fireEvent("finish",this,this.getWizardData())!==false){this.close()}},onPreviousClick:function(){if(this.currentCard>0){this.cardPanel.getLayout().setActiveItem(this.currentCard-1)}},onNextClick:function(){if(this.currentCard==this.cardCount-1){this.onFinish()}else{this.cardPanel.getLayout().setActiveItem(this.currentCard+1)}}});Ext.namespace("Ext.ux.Wiz");Ext.ux.Wiz.Header=Ext.extend(Ext.BoxComponent,{height:55,region:"north",title:"Wizard",steps:0,stepText:"Step {0} of {1}: {2}",autoEl:{tag:"div",cls:"ext-ux-wiz-Header",children:[{tag:"div",cls:"ext-ux-wiz-Header-title"},{tag:"div",children:[{tag:"div",cls:"ext-ux-wiz-Header-step"},{tag:"div",cls:"ext-ux-wiz-Header-stepIndicator-container"}]}]},titleEl:null,stepEl:null,imageContainer:null,indicators:null,stepTemplate:null,lastActiveStep:-1,updateStep:function(b,c){var a=this.stepTemplate.apply({0:b+1,1:this.steps,2:c});this.stepEl.update(a);if(this.lastActiveStep!=-1){this.indicators[this.lastActiveStep].removeClass("ext-ux-wiz-Header-stepIndicator-active")}this.indicators[b].addClass("ext-ux-wiz-Header-stepIndicator-active");this.lastActiveStep=b},onRender:function(d,b){Ext.ux.Wiz.Header.superclass.onRender.call(this,d,b);this.indicators=[];this.stepTemplate=new Ext.Template(this.stepText),this.stepTemplate.compile();var f=this.el.dom.firstChild;var e=f.nextSibling;this.titleEl=new Ext.Element(f);this.stepEl=new Ext.Element(e.firstChild);this.imageContainer=new Ext.Element(e.lastChild);this.titleEl.update(this.title);var g=null;for(var c=0,a=this.steps;c<a;c++){g=document.createElement("div");g.innerHTML="&#160;";g.className="ext-ux-wiz-Header-stepIndicator";this.indicators[c]=new Ext.Element(g);this.imageContainer.appendChild(g)}}});Ext.namespace("Ext.ux.Wiz");Ext.ux.Wiz.Card=Ext.extend(Ext.FormPanel,{header:false,hideMode:"display",initComponent:function(){this.addEvents("beforecardhide");Ext.ux.Wiz.Card.superclass.initComponent.call(this)},isValid:function(){if(this.monitorValid){return this.bindHandler()}return true},bindHandler:function(){if(!this.bound){return false}var d=true;this.form.items.each(function(e){if(e.isValid&&!e.isValid(true)){d=false;return false}});if(this.buttons){for(var c=0,a=this.buttons.length;c<a;c++){var b=this.buttons[c];if(b.formBind===true&&b.disabled===d){b.setDisabled(!d)}}}this.fireEvent("clientvalidation",this,d)},initEvents:function(){var a=this.monitorValid;this.monitorValid=false;Ext.ux.Wiz.Card.superclass.initEvents.call(this);this.monitorValid=a;this.on("beforehide",this.bubbleBeforeHideEvent,this);this.on("beforecardhide",this.isValid,this);this.on("show",this.onCardShow,this);this.on("hide",this.onCardHide,this)},bubbleBeforeHideEvent:function(){var a=this.ownerCt.layout;var b=a.activeItem;if(b&&b.id===this.id){return this.fireEvent("beforecardhide",this)}return true},onCardHide:function(){if(this.monitorValid){this.stopMonitoring()}},onCardShow:function(){if(this.monitorValid){this.startMonitoring()}}});Ext.namespace("Toc.ux.Wiz");Toc.ux.Wiz.Header=Ext.extend(Ext.ux.Wiz.Header,{descriptionEl:null,autoEl:{tag:"div",cls:"ext-ux-wiz-Header",children:[{tag:"div",cls:"ext-ux-wiz-Header-title"},{tag:"div",children:[{tag:"div",cls:"ext-ux-wiz-Header-step"},{tag:"div",cls:"ext-ux-wiz-step-description"},{tag:"div",cls:"ext-ux-wiz-Header-stepIndicator-container"}]}]},updateDescription:function(a){this.descriptionEl.update(a)},onRender:function(b,a){Toc.ux.Wiz.Header.superclass.onRender.call(this,b,a);var d=this.el.dom.firstChild;var c=d.nextSibling;this.descriptionEl=new Ext.Element(c.firstChild.nextSibling)}});Ext.namespace("Toc.ux.Wiz");Toc.ux.Wiz.Wizard=Ext.extend(Ext.ux.Wiz,{initPanels:function(){var b=this.cards;var a=this.cardPanelConfig;Ext.apply(this.headerConfig,{steps:b.length});this.headPanel=new Toc.ux.Wiz.Header(this.headerConfig);Ext.apply(a,{layout:new Ext.ux.layout.CardLayout(),items:b});Ext.applyIf(a,{region:"center",border:false,activeItem:0});this.cardPanel=new Ext.Panel(a)},onCardShow:function(c){var e=c.ownerCt;var b=e.items;for(var d=0,a=b.length;d<a;d++){if(b.get(d).id==c.id){break}}this.currentCard=d;this.headPanel.updateStep(d,c.title);this.headPanel.updateDescription(c.description);if(d==a-1){this.nextButton.setText(this.finishButtonText)}else{this.nextButton.setText(this.nextButtonText)}if(c.isValid()){this.nextButton.setDisabled(false)}if(d==0){this.previousButton.setDisabled(true)}else{this.previousButton.setDisabled(false)}}});Ext.Window.override({shadow:false,constrainHeader:true});Ext.grid.GridPanel.override({border:false,viewConfig:{emptyText:TocLanguage.gridNoRecords}});Ext.override(Ext.data.Store,{findExact:function(b,a,c){return this.data.findIndexBy(function(d){return d.get(b)===a},this,c)}});Ext.override(Ext.layout.FormLayout,{renderItem:function(e,a,d){if(e&&!e.rendered&&e.isFormField&&e.inputType!="hidden"){var b=[e.id,e.fieldLabel,(this.labelStyle||"")+";"+(e.labelStyle||""),this.elementStyle||"",typeof e.labelSeparator=="undefined"?this.labelSeparator:e.labelSeparator,(e.itemCls||this.container.itemCls||"")+(e.hideLabel?" x-hide-label":""),e.clearCls||"x-form-clear-left"];if(typeof a=="number"){a=d.dom.childNodes[a]||null}if(a){this.fieldTpl.insertBefore(a,b)}else{this.fieldTpl.append(d,b)}e.render("x-form-el-"+e.id)}else{Ext.layout.FormLayout.superclass.renderItem.apply(this,arguments)}}});Ext.override(Ext.grid.GridView,{initTemplates:function(){var c=this.templates||{};if(!c.master){c.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&nbsp;</div>','<div class="x-grid3-resize-proxy">&nbsp;</div>',"</div>")}if(!c.header){c.header=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>',"</table>")}if(!c.hcell){c.hcell=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}"><div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{value}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div></td>")}if(!c.body){c.body=new Ext.Template("{rows}")}if(!c.row){c.row=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table></div>")}if(!c.cell){c.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>")}for(var a in c){var b=c[a];if(b&&typeof b.compile=="function"&&!b.compiled){b.disableFormats=true;b.compile()}}this.templates=c;this.colRe=new RegExp("x-grid3-td-([^\\s]+)","")},updateAllColumnWidths:function(){var d=this.getTotalWidth();var k=this.cm.getColumnCount();var f=[];for(var b=0;b<k;b++){f[b]=this.getColumnWidth(b)}this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;for(var b=0;b<k;b++){var c=this.getHeaderCell(b);c.style.width=f[b]}var g=this.getRows(),l,h;for(var b=0,e=g.length;b<e;b++){l=g[b];l.style.width=d;if(l.firstChild){l.firstChild.style.width=d;h=l.firstChild.rows[0];for(var a=0;a<k;a++){h.childNodes[a].style.width=f[a]}}}this.onAllColumnWidthsUpdated(f,d)},updateColumnWidth:function(b,a){var h=this.getColumnWidth(b);var e=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=e;this.mainBody.dom.style.width=e;var d=this.getHeaderCell(b);d.style.width=h;var g=this.getRows(),j;for(var c=0,f=g.length;c<f;c++){j=g[c];j.style.width=e;if(j.firstChild){j.firstChild.style.width=e;j.firstChild.rows[0].childNodes[b].style.width=h}}this.onColumnWidthUpdated(b,h,e)},updateColumnHidden:function(a,e){var d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;var g=e?"none":"";var c=this.getHeaderCell(a);c.style.display=g;var h=this.getRows(),j;for(var b=0,f=h.length;b<f;b++){j=h[b];j.style.width=d;if(j.firstChild){j.firstChild.style.width=d;j.firstChild.rows[0].childNodes[a].style.display=g}}this.onColumnHiddenUpdated(a,e,d);delete this.lastViewWidth;this.layout()},afterRender:function(){this.mainBody.dom.innerHTML=this.renderRows()||"&nbsp;";this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}},renderUI:function(){var d=this.renderHeaders();var a=this.templates.body.apply({rows:"&nbsp;"});var b=this.templates.master.apply({body:a,header:d,ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";"});var c=this.grid;c.getGridEl().dom.innerHTML=b;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);this.mainHd.on("mouseover",this.handleHdOver,this);this.mainHd.on("mouseout",this.handleHdOut,this);this.mainHd.on("mousemove",this.handleHdMove,this);this.scroller.on("scroll",this.syncScroll,this);if(c.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(c,this.mainHd.dom)}if(c.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(c,this.innerHd);this.columnDrop=new Ext.grid.HeaderDropZone(c,this.mainHd.dom)}if(c.enableHdMenu!==false){if(c.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:c.id+"-hcols-menu"});this.colMenu.on("beforeshow",this.beforeColMenuShow,this);this.colMenu.on("itemclick",this.handleHdMenuClick,this)}this.hmenu=new Ext.menu.Menu({id:c.id+"-hctx"});this.hmenu.add({id:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{id:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(c.enableColumnHide!==false){this.hmenu.add("-",{id:"columns",text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(c.trackMouseOver){this.mainBody.on("mouseover",this.onRowOver,this);this.mainBody.on("mouseout",this.onRowOut,this)}if(c.enableDragDrop||c.enableDrag){this.dragZone=new Ext.grid.GridDragZone(c,{ddGroup:c.ddGroup||"GridDD"})}this.updateHeaderSortState()},onColumnWidthUpdated:function(c,a,b){},onAllColumnWidthsUpdated:function(a,b){},onColumnHiddenUpdated:function(b,c,a){},getOffsetWidth:function(){return(this.cm.getTotalWidth()+this.scrollOffset)+"px"},renderBody:function(){var a=this.renderRows()||"&nbsp;";return this.templates.body.apply({rows:a})},hasRows:function(){var a=this.mainBody.dom.firstChild;return a&&a.nodeType==1&&a.className!="x-grid-empty"},updateHeaders:function(){this.innerHd.firstChild.innerHTML=this.renderHeaders();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth()}});